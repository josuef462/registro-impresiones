<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Mensual de Impresiones - Color y B/N</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #0052a5 0%, #003366 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .hnl-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #f0b429;
            color: #333;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            padding: 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }
        
        .stat-box {
            background: white;
            border-radius: 10px;
            padding: 18px;
            margin: 10px;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            flex: 1;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #0052a5;
        }
        
        .hnl-currency {
            font-size: 1.5rem;
            color: #f0b429;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.95rem;
            color: #666;
            margin-top: 5px;
        }
        
        .controls {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .month-name {
            font-size: 1.5rem;
            font-weight: 600;
            min-width: 160px;
            text-align: center;
        }
        
        .btn {
            background-color: #0052a5;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: #003d7a;
            transform: translateY(-2px);
        }
        
        .btn-print {
            background-color: #28a745;
        }
        
        .btn-print:hover {
            background-color: #218838;
        }
        
        .btn-reset {
            background-color: #dc3545;
        }
        
        .btn-reset:hover {
            background-color: #c82333;
        }
        
        .price-settings {
            background-color: #fff9e6;
            padding: 15px 20px;
            border-bottom: 1px solid #ffe680;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .price-settings-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            flex: 1;
        }
        
        .price-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .price-input-group label {
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }
        
        .price-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100px;
        }
        
        .color-badge {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .color-badge.color {
            background: linear-gradient(45deg, #ff0000, #00ff00, #0000ff);
        }
        
        .color-badge.bw {
            background: linear-gradient(45deg, #333, #999, #ccc);
        }
        
        .table-container {
            padding: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        thead {
            background-color: #f0f7ff;
        }
        
        th {
            padding: 16px 8px;
            text-align: left;
            font-weight: 600;
            color: #0052a5;
            border-bottom: 2px solid #ddd;
            font-size: 0.9rem;
        }
        
        td {
            padding: 12px 8px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background-color: #f9fbfe;
        }
        
        .day-cell {
            font-weight: 600;
            width: 80px;
        }
        
        .date-cell {
            color: #666;
            width: 70px;
        }
        
        .input-cell {
            width: 120px;
        }
        
        .small-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            text-align: center;
        }
        
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: border 0.3s;
        }
        
        input[type="number"]:focus, input[type="text"]:focus {
            border-color: #0052a5;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 82, 165, 0.2);
        }
        
        .total-row {
            background-color: #f0f7ff;
            font-weight: 700;
        }
        
        .total-row td {
            padding: 16px 8px;
            font-size: 1rem;
        }
        
        .hnl-total {
            color: #0052a5;
        }
        
        .type-header {
            text-align: center;
            background-color: #f8f9fa;
            font-size: 0.85rem;
            padding: 8px;
        }
        
        .sub-header {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            padding: 4px 0;
        }
        
        .print-types {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .print-type {
            flex: 1;
            text-align: center;
            padding: 4px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .print-type.color {
            background-color: #fff0f0;
            color: #c00;
            border: 1px solid #ffcccc;
        }
        
        .print-type.bw {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        footer {
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            background-color: #f8f9fa;
        }
        
        @media (max-width: 1100px) {
            .price-settings {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .price-settings-container {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 20px;
            }
            
            .month-selector {
                order: 1;
            }
            
            .stats-container {
                flex-direction: column;
            }
            
            .stat-box {
                min-width: 100%;
            }
            
            .hnl-badge {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 10px;
                align-self: center;
            }
            
            .price-settings-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .price-input-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .price-input {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="hnl-badge">MONEDA: LEMPIRAS (HNL)</div>
            <h1><i class="fas fa-print"></i> Registro Mensual de Impresiones</h1>
            <p class="subtitle">Control diario de ingresos por impresiones a Color y Blanco/Negro</p>
        </header>
        
        <div class="price-settings">
            <div class="price-settings-container">
                <div class="price-input-group">
                    <label for="price-color"><span class="color-badge color"></span> Color (HNL):</label>
                    <input type="number" id="price-color" min="0.01" step="0.01" value="5.00" class="price-input">
                </div>
                <div class="price-input-group">
                    <label for="price-bw"><span class="color-badge bw"></span> Blanco/Negro (HNL):</label>
                    <input type="number" id="price-bw" min="0.01" step="0.01" value="2.00" class="price-input">
                </div>
            </div>
            <div>
                <button class="btn" id="apply-prices"><i class="fas fa-sync-alt"></i> Aplicar precios</button>
            </div>
        </div>
        
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-value"><span class="hnl-currency">L</span> <span id="month-total">0.00</span></div>
                <div class="stat-label">Total del mes (HNL)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value"><span class="hnl-currency">L</span> <span id="color-total">0.00</span></div>
                <div class="stat-label">Total Color (HNL)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value"><span class="hnl-currency">L</span> <span id="bw-total">0.00</span></div>
                <div class="stat-label">Total B/N (HNL)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="total-prints">0</div>
                <div class="stat-label">Total Impresiones</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="month-selector">
                <button class="btn" id="prev-month"><i class="fas fa-chevron-left"></i> Anterior</button>
                <div class="month-name" id="current-month">Enero 2023</div>
                <button class="btn" id="next-month">Siguiente <i class="fas fa-chevron-right"></i></button>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-reset" id="reset-month"><i class="fas fa-redo"></i> Reiniciar Mes</button>
                <button class="btn btn-print" id="print-data"><i class="fas fa-file-pdf"></i> Generar Reporte PDF</button>
            </div>
        </div>
        
        <div class="table-container">
            <table id="impressions-table">
                <thead>
                    <tr>
                        <th>Día</th>
                        <th>Fecha</th>
                        <th colspan="2" class="type-header">IMPRESIONES REALIZADAS</th>
                        <th>Ingreso Total (HNL)</th>
                        <th>Notas / Observaciones</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th></th>
                        <th class="sub-header"><span class="color-badge color"></span> Color</th>
                        <th class="sub-header"><span class="color-badge bw"></span> Blanco/Negro</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Las filas se generarán con JavaScript -->
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="2">TOTAL DEL MES</td>
                        <td id="total-color-prints">0</td>
                        <td id="total-bw-prints">0</td>
                        <td class="hnl-total"><span class="hnl-currency">L</span> <span id="total-income">0.00</span></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <footer>
            <p>Hoja de registro diseñada para control de ingresos por impresiones • Valores en Lempiras (HNL) • Los datos se guardan automáticamente</p>
        </footer>
    </div>

    <script>
        // Configuración inicial
        let currentDate = new Date();
        let impressionsData = {};
        let prices = {
            color: 5.00, // Precio por defecto para color
            bw: 2.00     // Precio por defecto para blanco y negro
        };
        
        // Nombres de los meses en español
        const monthNames = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        
        // Días de la semana en español
        const dayNames = [
            "Domingo", "Lunes", "Martes", "Miércoles", 
            "Jueves", "Viernes", "Sábado"
        ];
        
        // Cargar datos guardados
        function loadData() {
            const savedData = localStorage.getItem('impressionsDataColorBW');
            if (savedData) {
                impressionsData = JSON.parse(savedData);
            }
            
            // Cargar precios guardados
            const savedPrices = localStorage.getItem('printPricesHNL');
            if (savedPrices) {
                const loadedPrices = JSON.parse(savedPrices);
                prices.color = loadedPrices.color || 5.00;
                prices.bw = loadedPrices.bw || 2.00;
                
                document.getElementById('price-color').value = prices.color.toFixed(2);
                document.getElementById('price-bw').value = prices.bw.toFixed(2);
            }
        }
        
        // Guardar datos
        function saveData() {
            localStorage.setItem('impressionsDataColorBW', JSON.stringify(impressionsData));
            localStorage.setItem('printPricesHNL', JSON.stringify(prices));
            updateStats();
        }
        
        // Obtener clave para el mes actual
        function getMonthKey(date) {
            return `${date.getFullYear()}-${date.getMonth()}`;
        }
        
        // Inicializar datos del mes si no existen
        function initMonthData() {
            const monthKey = getMonthKey(currentDate);
            
            if (!impressionsData[monthKey]) {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                impressionsData[monthKey] = {
                    month: month,
                    year: year,
                    days: {}
                };
                
                // Inicializar todos los días del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    impressionsData[monthKey].days[day] = {
                        color: 0,
                        bw: 0,
                        income: 0,
                        notes: ""
                    };
                }
                
                saveData();
            }
        }
        
        // Calcular ingresos para un día
        function calculateDayIncome(colorCount, bwCount) {
            return (colorCount * prices.color) + (bwCount * prices.bw);
        }
        
        // Actualizar la tabla
        function updateTable() {
            const monthKey = getMonthKey(currentDate);
            const monthData = impressionsData[monthKey];
            const tableBody = document.getElementById('table-body');
            
            // Limpiar tabla
            tableBody.innerHTML = '';
            
            // Actualizar nombre del mes
            document.getElementById('current-month').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Calcular días en el mes
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let totalColor = 0;
            let totalBW = 0;
            let totalIncome = 0;
            
            // Crear filas para cada día del mes
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayName = dayNames[date.getDay()];
                const dayData = monthData.days[day] || { color: 0, bw: 0, income: 0, notes: "" };
                
                // Calcular ingresos si no está definido pero hay impresiones
                if ((dayData.color > 0 || dayData.bw > 0) && dayData.income === 0) {
                    dayData.income = calculateDayIncome(dayData.color, dayData.bw);
                }
                
                const row = document.createElement('tr');
                
                // Formatear fecha como DD/MM
                const formattedDate = `${day.toString().padStart(2, '0')}/${(month + 1).toString().padStart(2, '0')}`;
                
                row.innerHTML = `
                    <td class="day-cell">${dayName.substring(0, 3)}.</td>
                    <td class="date-cell">${formattedDate}</td>
                    <td class="input-cell">
                        <input type="number" min="0" value="${dayData.color}" 
                               data-day="${day}" data-type="color" 
                               placeholder="0" class="small-input">
                    </td>
                    <td class="input-cell">
                        <input type="number" min="0" value="${dayData.bw}" 
                               data-day="${day}" data-type="bw" 
                               placeholder="0" class="small-input">
                    </td>
                    <td class="input-cell">
                        <input type="number" min="0" step="0.01" value="${dayData.income.toFixed(2)}" 
                               data-day="${day}" data-type="income" 
                               placeholder="0.00" class="small-input">
                    </td>
                    <td>
                        <input type="text" value="${dayData.notes}" 
                               data-day="${day}" data-type="notes" 
                               placeholder="Observaciones" style="width: 100%; font-size: 0.9rem;">
                    </td>
                `;
                
                tableBody.appendChild(row);
                
                // Sumar a totales
                totalColor += dayData.color;
                totalBW += dayData.bw;
                totalIncome += dayData.income;
            }
            
            // Actualizar totales en la tabla
            document.getElementById('total-color-prints').textContent = totalColor;
            document.getElementById('total-bw-prints').textContent = totalBW;
            document.getElementById('total-income').textContent = totalIncome.toFixed(2);
            
            // Agregar eventos a los inputs
            attachInputEvents();
            
            // Actualizar estadísticas
            updateStats();
        }
        
        // Adjuntar eventos a los inputs
        function attachInputEvents() {
            const inputs = document.querySelectorAll('#table-body input');
            
            inputs.forEach(input => {
                input.addEventListener('change', function() {
                    const day = parseInt(this.dataset.day);
                    const type = this.dataset.type;
                    const monthKey = getMonthKey(currentDate);
                    const value = this.value;
                    
                    // Actualizar datos
                    if (type === 'color' || type === 'bw') {
                        impressionsData[monthKey].days[day][type] = parseInt(value) || 0;
                        
                        // Recalcular ingresos automáticamente
                        const dayData = impressionsData[monthKey].days[day];
                        dayData.income = calculateDayIncome(dayData.color, dayData.bw);
                        
                        // Actualizar el campo de ingresos en la tabla
                        const incomeInput = document.querySelector(`input[data-day="${day}"][data-type="income"]`);
                        if (incomeInput) {
                            incomeInput.value = dayData.income.toFixed(2);
                        }
                    } else if (type === 'income') {
                        impressionsData[monthKey].days[day].income = parseFloat(value) || 0;
                    } else if (type === 'notes') {
                        impressionsData[monthKey].days[day].notes = value;
                    }
                    
                    // Guardar y actualizar
                    saveData();
                    updateStats();
                });
                
                // Actualizar en tiempo real mientras se escribe
                input.addEventListener('input', function() {
                    updateStats();
                });
            });
        }
        
        // Actualizar estadísticas
        function updateStats() {
            const monthKey = getMonthKey(currentDate);
            const monthData = impressionsData[monthKey];
            
            if (!monthData) return;
            
            let monthTotal = 0;
            let colorTotal = 0;
            let bwTotal = 0;
            let totalPrints = 0;
            
            Object.values(monthData.days).forEach(day => {
                monthTotal += day.income;
                colorTotal += day.color * prices.color;
                bwTotal += day.bw * prices.bw;
                totalPrints += day.color + day.bw;
            });
            
            // Actualizar elementos de estadísticas
            document.getElementById('month-total').textContent = monthTotal.toFixed(2);
            document.getElementById('color-total').textContent = colorTotal.toFixed(2);
            document.getElementById('bw-total').textContent = bwTotal.toFixed(2);
            document.getElementById('total-prints').textContent = totalPrints;
        }
        
        // Cambiar mes
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            initMonthData();
            updateTable();
        }
        
        // Reiniciar mes actual
        function resetCurrentMonth() {
            if (confirm("¿Estás seguro de que quieres reiniciar todos los datos de este mes? Esta acción no se puede deshacer.")) {
                const monthKey = getMonthKey(currentDate);
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                // Reinicializar todos los días del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    impressionsData[monthKey].days[day] = {
                        color: 0,
                        bw: 0,
                        income: 0,
                        notes: ""
                    };
                }
                
                saveData();
                updateTable();
            }
        }
        
        // Aplicar nuevos precios a todo el mes
        function applyNewPrices() {
            const newColorPrice = parseFloat(document.getElementById('price-color').value);
            const newBWPrice = parseFloat(document.getElementById('price-bw').value);
            
            if (isNaN(newColorPrice) || newColorPrice <= 0 || isNaN(newBWPrice) || newBWPrice <= 0) {
                alert("Por favor, ingresa precios válidos (mayores a 0) para ambos tipos de impresión");
                return;
            }
            
            prices.color = newColorPrice;
            prices.bw = newBWPrice;
            
            const monthKey = getMonthKey(currentDate);
            const monthData = impressionsData[monthKey];
            
            // Recalcular ingresos basados en los nuevos precios
            Object.keys(monthData.days).forEach(day => {
                const dayData = monthData.days[day];
                dayData.income = calculateDayIncome(dayData.color, dayData.bw);
            });
            
            saveData();
            updateTable();
            
            alert(`Precios actualizados:\nColor: L ${prices.color.toFixed(2)}\nBlanco/Negro: L ${prices.bw.toFixed(2)}\n\nSe han recalculado los ingresos del mes.`);
        }
        
        // Generar reporte PDF
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            const monthKey = getMonthKey(currentDate);
            const monthData = impressionsData[monthKey];
            
            if (!monthData) return;
            
            const monthName = monthNames[currentDate.getMonth()];
            const year = currentDate.getFullYear();
            
            // Configuración inicial del documento
            doc.setFontSize(20);
            doc.setTextColor(0, 82, 165);
            doc.text(`Reporte de Impresiones - ${monthName} ${year}`, 148, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text("Moneda: Lempiras (HNL) - Impresiones a Color y Blanco/Negro", 148, 28, { align: 'center' });
            
            // Estadísticas
            let monthTotal = 0;
            let colorPrints = 0;
            let bwPrints = 0;
            let colorIncome = 0;
            let bwIncome = 0;
            
            Object.values(monthData.days).forEach(day => {
                monthTotal += day.income;
                colorPrints += day.color;
                bwPrints += day.bw;
                colorIncome += day.color * prices.color;
                bwIncome += day.bw * prices.bw;
            });
            
            const totalPrints = colorPrints + bwPrints;
            
            // Tabla de estadísticas
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text("Resumen del Mes", 20, 45);
            
            doc.autoTable({
                startY: 50,
                head: [['Estadística', 'Color', 'Blanco/Negro', 'Total']],
                body: [
                    ['Cantidad de impresiones', colorPrints, bwPrints, totalPrints],
                    ['Ingresos (HNL)', `L ${colorIncome.toFixed(2)}`, `L ${bwIncome.toFixed(2)}`, `L ${monthTotal.toFixed(2)}`],
                    ['Precio unitario', `L ${prices.color.toFixed(2)}`, `L ${prices.bw.toFixed(2)}`, ''],
                    ['Porcentaje de impresiones', `${totalPrints > 0 ? ((colorPrints/totalPrints)*100).toFixed(1) : 0}%`, `${totalPrints > 0 ? ((bwPrints/totalPrints)*100).toFixed(1) : 0}%`, '100%']
                ],
                theme: 'grid',
                headStyles: { fillColor: [0, 82, 165], textColor: [255, 255, 255] },
                margin: { left: 20 },
                columnStyles: {
                    0: { cellWidth: 60 },
                    1: { cellWidth: 40, halign: 'center' },
                    2: { cellWidth: 50, halign: 'center' },
                    3: { cellWidth: 40, halign: 'center' }
                }
            });
            
            // Datos diarios
            const tableData = [];
            
            // Encabezados de la tabla
            tableData.push(['Día', 'Fecha', 'Color', 'B/N', 'Total', 'Ingreso (HNL)', 'Observaciones']);
            
            // Llenar datos diarios
            for (let day = 1; day <= Object.keys(monthData.days).length; day++) {
                const dayData = monthData.days[day];
                const date = new Date(year, currentDate.getMonth(), day);
                const dayName = dayNames[date.getDay()].substring(0, 3);
                const formattedDate = `${day.toString().padStart(2, '0')}/${(currentDate.getMonth() + 1).toString().padStart(2, '0')}`;
                const dayTotal = dayData.color + dayData.bw;
                
                tableData.push([
                    dayName,
                    formattedDate,
                    dayData.color || 0,
                    dayData.bw || 0,
                    dayTotal,
                    `L ${dayData.income.toFixed(2)}`,
                    dayData.notes || ''
                ]);
            }
            
            // Agregar fila de totales
            tableData.push(['TOTAL', '', colorPrints, bwPrints, totalPrints, `L ${monthTotal.toFixed(2)}`, '']);
            
            // Crear tabla de datos diarios
            doc.setFontSize(14);
            doc.text("Registro Diario Detallado", 20, doc.autoTable.previous.finalY + 20);
            
            doc.autoTable({
                startY: doc.autoTable.previous.finalY + 25,
                head: [tableData[0]],
                body: tableData.slice(1, -1),
                foot: [tableData[tableData.length - 1]],
                theme: 'grid',
                headStyles: { fillColor: [0, 82, 165], textColor: [255, 255, 255] },
                footStyles: { fillColor: [240, 240, 240], textColor: [0, 0, 0], fontStyle: 'bold' },
                margin: { left: 20 },
                styles: { fontSize: 8 },
                columnStyles: {
                    0: { cellWidth: 20 },
                    1: { cellWidth: 25 },
                    2: { cellWidth: 20, halign: 'center' },
                    3: { cellWidth: 25, halign: 'center' },
                    4: { cellWidth: 25, halign: 'center' },
                    5: { cellWidth: 35, halign: 'center' },
                    6: { cellWidth: 'auto' }
                }
            });
            
            // Pie de página
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text(`Página ${i} de ${pageCount}`, 148, 200, { align: 'center' });
                doc.text(`Generado el: ${new Date().toLocaleDateString('es-HN')}`, 148, 205, { align: 'center' });
                doc.text(`Precios: Color L ${prices.color.toFixed(2)} | B/N L ${prices.bw.toFixed(2)}`, 148, 210, { align: 'center' });
            }
            
            // Guardar el PDF
            doc.save(`Reporte_Impresiones_${monthName}_${year}.pdf`);
        }
        
        // Inicializar la aplicación
        function initApp() {
            loadData();
            initMonthData();
            updateTable();
            
            // Configurar eventos de botones
            document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
            document.getElementById('next-month').addEventListener('click', () => changeMonth(1));
            document.getElementById('reset-month').addEventListener('click', resetCurrentMonth);
            document.getElementById('print-data').addEventListener('click', generatePDFReport);
            document.getElementById('apply-prices').addEventListener('click', applyNewPrices);
            
            // Eventos para actualizar precios al cambiar los inputs
            document.getElementById('price-color').addEventListener('change', function() {
                const newPrice = parseFloat(this.value);
                if (!isNaN(newPrice) && newPrice > 0) {
                    prices.color = newPrice;
                    localStorage.setItem('printPricesHNL', JSON.stringify(prices));
                }
            });
            
            document.getElementById('price-bw').addEventListener('change', function() {
                const newPrice = parseFloat(this.value);
                if (!isNaN(newPrice) && newPrice > 0) {
                    prices.bw = newPrice;
                    localStorage.setItem('printPricesHNL', JSON.stringify(prices));
                }
            });
        }
        
        // Iniciar la aplicación cuando se cargue la página
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>